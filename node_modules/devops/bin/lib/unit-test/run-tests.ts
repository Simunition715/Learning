import child_process from "child_process";
import path from "path";

async function run() {
  // See if we are running the unit tests with the need to attach a debug console
  const debug = Boolean(process.env.DEBUG);
  const pattern = process.env.PATTERN;
  const watch = process.env.WATCH;
  // Run prettier once
  const jestConfig = path.resolve("jest.config.js");

  if (debug) {
    child_process.execFileSync(
      "node",
      [
        "--inspect-brk",
        path.resolve("node_modules/.bin/jest"),
        "--runInBand",
        watch ? "--watchAll" : "",
        "--verbose",
        "--colors",
        "--config",
        jestConfig,
        pattern ? `--testNamePattern ${pattern}` : "",
      ],
      { stdio: "inherit" }
    );
  } else {
    child_process.execFileSync(
      "jest",
      [
        watch ? "--watchAll" : "",
        "--verbose",
        "--colors",
        "--config",
        jestConfig,
        pattern ? `--testNamePattern=${pattern}` : "",
      ],
      { stdio: "inherit" }
    );
  }
}

run();
