import child_process from "child_process";
import { isChildProcessError } from "./is-child-process-error.js";

/**
 * Executes an `npm run <command>` in the current context.
 *
 * Returns true if the command succeeded.
 */
export async function npmRun(command: string, args: string[] = []) {
  try {
    child_process.execFileSync("npm", ["run", command, ...args], {
      stdio: "inherit",
    });
  } catch (err) {
    if (isChildProcessError(err)) {
      console.error(
        `Error: npm run ${command} ${args.join(" ")} failed with code: ${
          err.status
        }`
      );

      return false;
    }
  }

  return true;
}
