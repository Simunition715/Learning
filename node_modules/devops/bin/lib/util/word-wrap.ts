/**
 * This looks through lines of text (breaking on newlines and returns) then
 * breaks down the words in each line to fit within the character count.
 */
export function wordWrap(paragraph: string, charCount: number) {
  // Break the paragraph into lines (windows)
  let lines = paragraph.split("\r\n");
  // Break the paragraph into lines (linux)
  if (lines.length === 1) lines = paragraph.split("\r");
  // Break the paragraph into lines (mac)
  if (lines.length === 1) lines = paragraph.split("\n");

  const wrappedLines: string[] = [];

  // Each existing new line should be preserved, but each of those lines should
  // be wrapped.

  lines.forEach((line) => {
    let output = "";
    // Get the initial indentation of the line
    const indentation = line.match(/^\s*/)?.[0] ?? "";
    // Start with the indentation of the line
    let currentLine = indentation;
    // Break the line into words
    const words = line.split(" ");

    // Loop through each word
    for (const word of words) {
      // If the current line plus the word is greater than the character count
      if (currentLine.length + word.length > charCount) {
        // Append the current line to the output
        output += `${currentLine}\n`;
        // Reset the current line
        currentLine = "";
      }

      // Append the word to the current line
      currentLine += `${word} `;
    }

    // Append the last line to the output
    output += `${currentLine.trim()}\n`;
    // Reset the current line
    currentLine = "";

    wrappedLines.push(`${indentation}${output.trim()}`);
  });

  return wrappedLines.join("\n");
}
