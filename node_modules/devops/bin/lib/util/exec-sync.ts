import child_process from "child_process";
import { isChildProcessError } from "./is-child-process-error.js";
import { isDefined } from "./types.js";

/**
 * Executes a command on the same stdio as the current process. This absorbs
 * errors and also ignores null/undefined arguments.
 *
 * Returns true if the command succeeded.
 */
export async function execSync(command: string, args: string[] = []) {
  try {
    child_process.execFileSync(command, args.filter(isDefined), {
      stdio: "inherit",
    });
  } catch (err) {
    if (isChildProcessError(err)) {
      console.error(
        `Error: ${command} ${args.join(" ")} failed with code: ${err.status}`
      );

      return false;
    }
  }

  return true;
}
