import child_process from "child_process";
import { isChildProcessError } from "./is-child-process-error.js";
import { isDefined } from "./types.js";

/**
 * Executes an `npm install [packages...]` in the current context.
 *
 * Returns true if the command succeeded.
 */
export async function npmInstall(packages: string[], options?: "D" | "DE") {
  try {
    child_process.execFileSync(
      "npm",
      ["i", options ? `-${options}` : null, packages.join(" ")].filter(
        isDefined
      ),
      {
        stdio: "inherit",
      }
    );
  } catch (err) {
    if (isChildProcessError(err)) {
      console.error(
        `Error: npm i ${options ? `-${options}` : ""} ${packages.join(
          " "
        )} failed with code: ${err.status}`
      );

      return false;
    }
  }

  return true;
}
