import path from "path";
import { createRequire } from "module";

/**
 * Get the path to the node_modules/.cache folder for a given package.
 *
 * @param packageName Required name of the npm package to identify
 * @param folder Required name of the folder to place inside the node_modules/.cache folder
 * @returns Full path to the cache folder
 */
export async function getPackageCachePath(
  packageName: string,
  folder: string
): Promise<string> {
  const require = createRequire(import.meta.url);
  const modulePath = require.resolve(packageName);

  // Get puppeteer's node_module path
  const parts = modulePath.split("node_modules");
  const moduleRoot = parts[0];
  const moduleDir = parts[1].split(path.sep)[1];

  // Create a path to the desired cache location
  const moduleCachePath = path.join(
    moduleRoot,
    "node_modules",
    moduleDir,
    "node_modules",
    ".cache",
    folder
  );

  return moduleCachePath;
}
